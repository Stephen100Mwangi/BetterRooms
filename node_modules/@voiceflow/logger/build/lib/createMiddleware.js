"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const pino_http_1 = __importDefault(require("pino-http"));
const constants_1 = require("./constants");
const utils_1 = require("./utils");
const getSerializer = (verbosity) => {
    switch (verbosity) {
        case constants_1.MiddlewareVerbosity.NONE:
            return utils_1.noSerializer;
        case constants_1.MiddlewareVerbosity.SHORT:
            return utils_1.shortSerializer;
        case constants_1.MiddlewareVerbosity.FULL:
            return utils_1.fullSerializer;
        case constants_1.MiddlewareVerbosity.DEBUG:
            return utils_1.debugSerializer;
        default:
            return utils_1.fullSerializer;
    }
};
const createMiddleware = ({ logger, genReqId, verbosity, }) => pino_http_1.default({
    logger,
    genReqId,
    serializers: getSerializer(verbosity),
    customLogLevel(res, err) {
        if (res.statusCode >= 500 || err) {
            return constants_1.Level.ERROR;
        }
        if (res.statusCode >= 400) {
            if (res.statusCode === 404) {
                return constants_1.Level.TRACE;
            }
            return constants_1.Level.WARN;
        }
        return constants_1.Level.INFO;
    },
    customSuccessMessage(res) {
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        const { baseUrl, path } = res.req;
        if (baseUrl || path) {
            return `${res.statusCode} | ${baseUrl !== null && baseUrl !== void 0 ? baseUrl : ''}${path !== null && path !== void 0 ? path : ''} `;
        }
        // This should never happen
        return `${res.statusCode} | (unknown path)`;
    },
});
exports.default = createMiddleware;
//# sourceMappingURL=createMiddleware.js.map